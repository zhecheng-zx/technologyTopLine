<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>搜索页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../css/mui.min.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
		<style>
			body {
				width: 100%;
				height: 100%;
				background: #fff;
			}
			
			.mui-content {
				background: #fff;
			}
			
			.search-wrapper {
				background: #3385FF;
				padding: 15px 15px 10px 15px;
				color: #fff;
			}
			
			.cancel-search {
				width: 40px;
				color: #fff;
				font-size: 13px;
				height: 30px;
				line-height: 30px;
				text-align: center;
			}
			
			.mui-search {
				width: calc(100% - 50px);
			}
			
			input.mui-input-clear {
				background: #fff;
				font-size: 12px;
				height: 30px;
				color: #333;
				margin-bottom: 10px;
			}
			
			.mui-search .mui-placeholder {
				height: 30px;
				line-height: 30px;
				text-align: left;
				left: 20px;
			}
			
			.mui-input-row.mui-search .mui-icon-clear {
				top: 5px;
			}
			
			.mui-search .mui-placeholder .mui-icon {
				font-size: 16px;
				margin-right: 3px;
			}
			
			.mui-search .mui-placeholder {
				font-size: 12px;
			}
			
			.mui-card {
				background: #3385FF;
				-webkit-box-shadow: none;
				box-shadow: none;
				margin: 10px 0px 0px;
			}
			
			.mui-card .mui-card-header {
				min-height: 36px;
				padding: 0px 0px;
				color: #eee;
				font-size: 14px;
			}
			
			.mui-card .mui-card-header>a {
				font-size: 12px;
				color: #ffffff;
			}
			
			.mui-card .mui-card-header:after {
				display: none;
			}
			
			.mui-card-content {
				height: 75px;
				overflow: hidden;
			}
			
			.wanna-search-ul {
				margin: 0;
				padding: 0;
				width: 100%;
				list-style: none;
				font-size: 0px;
			}
			
			.wanna-search-ul:before,
			.wanna-search-ul:after {
				display: table;
				content: " ";
			}
			
			.wanna-search-ul:after {
				clear: both;
			}
			
			.wanna-search-ul>li {
				display: inline-block;
				font-size: 12px;
				color: #fff;
				padding: 6px 10px;
				background: #5c9dff;
				margin-right: 5px;
				margin-bottom: 5px;
				border-radius: 3px;
			}
			
			.more-box {
				display: none;
				margin-top: 5px;
			}
			
			.more-box a {
				color: #fff;
				font-size: 11px;
			}
			
			.more-box .iconfont {
				font-size: 11px;
			}
			
			.search-history {
				padding: 15px;
			}
			
			h5.text {
				color: #333;
			}
			
			.mui-icon-trash {
				font-size: 11px;
			}
			
			.mui-icon-trash:before {
				font-size: 13px;
			}
			
			.history-ul{
				height: 410px;
				overflow: hidden;
			}
			
			.history-ul:before {
				display: none;
			}
			
			.history-ul:after {
				left: 15px;
			}
			
			.history-ul .mui-table-view-cell {
				font-size: 13px;
				color: #666;
				width: 100%;
				padding: 8px 15px;
			}
			
			.history-ul .mui-table-view-cell a{
				display: inline-block;
			}
			
			.history-ul .iconfont {
				font-size: 13px;
				margin-right: 5px;
			}
			
			.hide-wanna-search {
				display: none;
			}
			
			.show-wanna-search,
			.hide-wanna-search {
				margin: 0px;
				width: 100%;
				color: #eee;
				font-size: 14px;
			}
		
			
			.mui-table-view-cell>a:not(.mui-btn) {
				margin: auto;
				padding: 0px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content mui-scroll-wrapper">
			<div class="search-wrapper">
				<div class="search-box mui-clearfix">
					<div class="mui-input-row mui-search mui-pull-left">
						<input type="search" class="mui-input-clear" placeholder="请输入关键字" id="searchInput">
					</div>
					<a href="javascript:;" class="text mui-pull-right cancel-search" id="cancelSearch">取消</a>
				</div>
				<div class="mui-card wanna-search-box">
					<!--页眉，放置标题-->
					<div class="mui-card-header">
						<p class="show-wanna-search">
							猜你想搜的
							<span class="mui-icon iconfont icon-DLS_Hide_ mui-pull-right"></span>
						</p>
						<p class="hide-wanna-search mui-text-center">
							<span class="mui-icon iconfont icon-eye"></span> 查看全部推荐词
						</p>
					</div>
					<!--内容区-->
					<div class="mui-card-content">
						<ul class="wanna-search-ul" id="wannaSearchUl">
							<li data-li="1">
								科技驱动创新
							</li>
							<li data-li="2">
								铝基新材料
							</li>
							<li data-li="3">
								3D打印材料
							</li>
							<li data-li="4">
								互联网经济
							</li>
							<li data-li="5">
								纳米制造技术
							</li>
							<li data-li="6">
								石墨烯
							</li>
							<li data-li="7">
								跨境电商
							</li>
							<li data-li="8">
								智慧旅游
							</li>
							<li data-li="9">
								互联网金融
							</li>
						</ul>
					</div>
					<div class="more-box mui-text-center">
						<a href="javascript:;" id="searchMore">
							<span class="text">查看更多</span>
							<span class="mui-icon iconfont icon-down"></span>
						</a>
					</div>
				</div>
			</div>
			<div class="search-history  mui-scroll">
				<h5 class="text">搜索历史
					<p class="mui-pull-right">
						<span class="mui-icon mui-icon-trash" id="clearAllHistory">清空</span>
					</p>
				</h5>
				<ul class="mui-table-view history-ul" id="history-ul">
					<li class="mui-table-view-cell">
						<a href="javascript:;"><span class="mui-icon iconfont icon-liulanjilu"></span>大数据人工智能</a>
						<span class="mui-icon ui-icon mui-icon-closeempty mui-pull-right"></span>
					</li>
					<li class="mui-table-view-cell">
						<span class="mui-icon iconfont icon-liulanjilu"></span>新能源汽车
						<span class="mui-icon ui-icon mui-icon-closeempty mui-pull-right"></span>
					</li>
					<li class="mui-table-view-cell">
						<span class="mui-icon iconfont icon-liulanjilu"></span>海洋资源
						<span class="mui-icon ui-icon mui-icon-closeempty mui-pull-right"></span>
					</li>
				</ul>
			</div>		
		</div>
		<script src="../../vendor/jQuery/jquery.min.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script>					
			
			$(document).ready(function() {
				//猜你想搜的   查看更多是否显示
				var $box = $('.more-box');
				if($('.wanna-search-ul').height() > 110) {
					$box.show();
				} else {
					$box.hide();
				}
				
				getSearchHistory();
			});

			mui('.mui-content').on('tap', '#searchMore', function() {
				var $content = $('.mui-card-content'),
					$moreText = $('#searchMore .text'),
					$moreIcon = $('#searchMore .mui-icon');

				if($content.height() == 75) {
					var ulHeight = $('.wanna-search-ul').height();
					$content.height(ulHeight);
					$moreText.text('收起');
					$moreIcon.removeClass('icon-down').addClass('icon-up');
				} else {
					$content.height(75);
					$moreText.text('查看更多');
					$moreIcon.addClass('icon-down').removeClass('icon-up');
				}
			});

			mui('.mui-content').on('tap', '#cancelSearch', function() {
				document.getElementById('searchInput').value = '';
				mui.back();
			});

			var nativeWebview, imm, InputMethodManager;
			var initNativeObjects = function() {
				if(mui.os.android) {
					var main = plus.android.runtimeMainActivity();
					var Context = plus.android.importClass("android.content.Context");
					InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
					imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
				} else {
					nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
				}
			};
			var showSoftInput = function() {
				var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
				if(mui.os.android) {
					//强制当前webview获得焦点
					plus.android.importClass(nativeWebview);
					nativeWebview.requestFocus();
					imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
				} else {
					nativeWebview.plusCallMethod({
						"setKeyboardDisplayRequiresUserAction": false
					});
				}
				setTimeout(function() {
					//此处可写具体逻辑设置获取焦点的input
					var inputElem = document.querySelector('input');
					inputElem.focus();
				}, 200);
			};
			
			mui.plusReady(function() {
				initNativeObjects();
				showSoftInput();
			});

			//是否隐藏 猜你想搜 内容
			mui('.mui-content').on('tap', '.icon-DLS_Hide_', function() {
				$('.hide-wanna-search').show();
				$('.show-wanna-search').hide();
				$('.mui-card-content').hide();
				$('.more-box').hide();
			});

			mui('.mui-content').on('tap', '.hide-wanna-search', function() {
				$('.hide-wanna-search').hide();
				$('.show-wanna-search').show();
				$('.mui-card-content').show();
			});

			/**
			 * 改变输入框的值
			 */
			document.getElementById('searchInput').addEventListener('input', function(e){
				var val = $(this).val();
				if(!val) {
					$('.hide-wanna-search').hide();
					$('.show-wanna-search').show();
					$('.mui-card-content').show();
				}
				var w = plus.webview.getWebviewById('searchList.html');
				if(w != null){
					w.close();	
				}				
			});

			document.getElementById('searchInput').addEventListener('keydown', function(e) {
				if(13 == e.keyCode) {
					var text = this.value;
					if(!text) {
						plus.nativeUI.toast('请输入要搜索的内容', {verticalAlign: "center"});
						return;
					}
					saveSearchHistory(text);
					beforeSearch(text);					
				}
			});

			//清空输入框的值			
			mui('.search-box').on('tap', '.mui-icon-clear', function(e) {
				$('.wanna-search-box').show();
				$('.search-history').show();			
				var w = plus.webview.getWebviewById('searchList.html');
				if(w != null){
					w.close();
				}				
			});			

			mui('.search-history').on('tap', '#clearAllHistory', function(){
				$('#history-ul').empty();
			});							
			
			mui('#wannaSearchUl').on('tap', 'li', function(){
				var text = $(this).text().trim();
				saveSearchHistory(text);
				beforeSearch(text);						
			});
			
			function saveSearchHistory(text){
				if(!text){
					return ;
				}
				
				var searchList = localStorage.getItem('searchList');
				//每次只存10个搜索历史
				
				if(!searchList){
					searchList = new Array();
				}else{
					searchList = JSON.parse(searchList);
				}
				
				if(searchList.length >= 10){
					searchList.splice(9);				
				}
				
				searchList.push(text);				
				localStorage.clear('searchList');
				localStorage.setItem('searchList', JSON.stringify(searchList));
				
				var _li = '<li class="mui-table-view-cell">' +
							'<a><span class="mui-icon iconfont icon-liulanjilu"></span>' + text + '</a>' +
							'<span class="mui-icon ui-icon mui-icon-closeempty mui-pull-right"></span>' +
						'</li>';
				$('#history-ul').prepend(_li);
				
				$('#history-ul li:first .mui-icon-closeempty').on('tap', function(){
					$(this).closest('li').remove();
				});
				
				$('#history-ul li:first a').on('tap', function(e){
					e.stopPropagation();
					e.preventDefault();
					var text = $(this).text().trim();
					beforeSearch(text);					
				});
				
				if($('#history-ul li').length > 10){
					$('#history-ul li').get(10).remove();
				}
			}
			
			function getSearchHistory(){
				var searchList = localStorage.getItem('searchList');
				searchList = JSON.parse(searchList);
				$('#history-ul').empty();
				if(searchList){
					for(var i = 0; i < searchList.length; i++){
						var _li = '<li class="mui-table-view-cell">'
								+ '<a><span class="mui-icon iconfont icon-liulanjilu"></span>' + searchList[i] + '</a>' 
								+ '<span class="mui-icon ui-icon mui-icon-closeempty mui-pull-right"></span>' +
							'</li>';
						$('#history-ul').prepend(_li);
					}
					hisSearchEvent();
					deleteSingleHistory();
				}
			}
			
			function hisSearchEvent(){
				//历史搜索
				mui('#history-ul').on('tap', 'li a', function(e){
					e.preventDefault();
					e.stopPropagation();
					var text = $(this).text().trim();
					beforeSearch(text);
					$('#searchInput').attr('placeholder', text);					
				});
			}
			
			function deleteSingleHistory(){
				mui('.history-ul').on('tap', '.mui-icon-closeempty', function(e) {
					$(this).closest('li').remove();
				});
			}
			
			function beforeSearch(text){
				document.activeElement.blur(); //隐藏软键盘 
				document.getElementById('searchInput').value = text;
				mui.openWindow({
					url: 'searchList.html',
					id: 'searchList.html',
					styles:{
						top: '70px',
						bottom: '0px'
					},
					waiting: {
						autoShow: true,
						title: '正在加载...'
					},
					extras: {
						searchText: text //扩展参数						
					}
				});
			}
	</script>
</body>

</html>